# トラブルシューティングガイド

このガイドでは、Multi-AI Translatorの使用中に発生する可能性のある一般的な問題とその解決方法を説明します。

## 目次

1. [インストール関連の問題](#インストール関連の問題)
2. [API接続の問題](#api接続の問題)
3. [翻訳機能の問題](#翻訳機能の問題)
4. [パフォーマンスの問題](#パフォーマンスの問題)
5. [プロバイダー固有の問題](#プロバイダー固有の問題)
6. [ブラウザ互換性の問題](#ブラウザ互換性の問題)

## インストール関連の問題

### 拡張機能がインストールできない

**症状**：拡張機能をインストールしようとするとエラーが発生する

**解決策**：
1. ブラウザが最新版であることを確認
2. 十分なディスク容量があることを確認
3. 他の拡張機能を一時的に無効化して試す
4. ブラウザを再起動して再試行

### 拡張機能が表示されない

**症状**：インストール後、拡張機能のアイコンが表示されない

**解決策**：
1. ブラウザのツールバーを右クリック→「拡張機能アイコンを表示」
2. `chrome://extensions/`（または`edge://extensions/`）で拡張機能が有効になっているか確認
3. ブラウザを再起動

### 開発版の読み込みエラー

**症状**：「パッケージ化されていない拡張機能」として読み込む際にエラーが発生

**解決策**：
1. `npm run build` が正常に完了したか確認
2. `dist` フォルダが存在することを確認
3. `manifest.json` の構文エラーをチェック
4. ビルドログでエラーメッセージを確認

```bash
# クリーンビルドを試す
rm -rf dist node_modules
npm install
npm run build
```

## API接続の問題

### "API key invalid" エラー

**症状**：翻訳を試みると「APIキーが無効です」というエラーが表示される

**解決策**：
1. **APIキーの確認**：
   - 設定ページでAPIキーを再確認
   - 余分なスペースや改行がないか確認
   - キーをコピー＆ペーストで再入力

2. **プロバイダーダッシュボードで確認**：
   - OpenAI: [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
   - Claude: [console.anthropic.com](https://console.anthropic.com/)
   - Gemini: [makersuite.google.com](https://makersuite.google.com/app/apikey)
   - キーが有効で、削除されていないことを確認

3. **新しいキーを生成**：
   - 古いキーを削除
   - 新しいキーを生成
   - 拡張機能に新しいキーを設定

### "Rate limit exceeded" エラー

**症状**：翻訳が「レート制限を超えました」というエラーで失敗する

**解決策**：
1. **待機**：
   - 数分待ってから再試行
   - APIプロバイダーの制限がリセットされるまで待つ

2. **設定を調整**：
   - 設定で「リクエスト間隔」を増やす（例：500ms → 1000ms）
   - チャンクサイズを小さくして、一度に送信するテキスト量を減らす

3. **プランを確認**：
   - APIプロバイダーのダッシュボードで使用量を確認
   - 必要に応じてプランをアップグレード

4. **別のプロバイダーを使用**：
   - Ollamaなどのローカルプロバイダーに切り替え

### "Network error" エラー

**症状**：「ネットワークエラー」が表示される

**解決策**：
1. **インターネット接続を確認**：
   - 他のウェブサイトにアクセスできるか確認
   - WiFi/イーサネット接続を確認

2. **プロバイダーのステータスを確認**：
   - OpenAI: [status.openai.com](https://status.openai.com/)
   - Claude: [status.anthropic.com](https://status.anthropic.com/)
   - サービスがダウンしていないか確認

3. **ファイアウォール/プロキシ設定**：
   - 企業ネットワークの場合、ファイアウォールがAPIへのアクセスをブロックしていないか確認
   - VPNを使用している場合、一時的に無効化して試す

4. **ブラウザの設定**：
   - ブラウザのキャッシュとクッキーをクリア
   - シークレットモードで試す

### CORS エラー

**症状**：コンソールに「CORS policy」に関するエラーが表示される

**解決策**：
1. **Ollamaの場合**：
   ```bash
   # CORS設定を追加してOllamaを起動
   OLLAMA_ORIGINS="*" ollama serve
   ```

2. **カスタムAPIの場合**：
   - APIサーバーでCORSヘッダーを設定
   - `Access-Control-Allow-Origin: *` を追加

3. **プロキシを使用**：
   - ローカルプロキシサーバーを経由してAPIにアクセス

## 翻訳機能の問題

### 翻訳が開始されない

**症状**：「ページを翻訳」ボタンをクリックしても何も起こらない

**解決策**：
1. **設定を確認**：
   - プロバイダーが有効になっているか確認
   - APIキーが設定されているか確認
   - モデルが選択されているか確認

2. **ブラウザコンソールを確認**：
   - F12キーを押してDevToolsを開く
   - コンソールタブでエラーメッセージを確認

3. **拡張機能を再読み込み**：
   - `chrome://extensions/` にアクセス
   - Multi-AI Translatorの「再読み込み」ボタンをクリック

4. **ページを再読み込み**：
   - 翻訳したいページを再読み込み
   - 再度翻訳を試行

### 翻訳が途中で止まる

**症状**：翻訳が開始されるが、完了せずに止まる

**解決策**：
1. **ページサイズを確認**：
   - 非常に大きなページの場合、時間がかかることがある
   - 選択翻訳で部分的に翻訳することを検討

2. **チャンクサイズを調整**：
   - 設定でチャンクサイズを小さくする（例：5000 → 2000文字）

3. **タイムアウト設定を増やす**：
   - 設定で「タイムアウト」値を増やす（例：30秒 → 60秒）

4. **別のモデルを試す**：
   - より高速なモデルに変更（例：GPT-4 → GPT-3.5）

### 翻訳結果がおかしい

**症状**：翻訳されたテキストが不自然、意味不明、または文字化けしている

**解決策**：
1. **モデルを変更**：
   - より高性能なモデルを試す（例：GPT-3.5 → GPT-4）
   - 別のプロバイダーを試す

2. **プロンプトをカスタマイズ**：
   - 設定の「カスタムプロンプト」で指示を追加
   - 例：「自然で読みやすい日本語に翻訳してください」

3. **元言語を指定**：
   - 設定で「元言語」を明示的に指定（自動検出ではなく）

4. **ページのエンコーディングを確認**：
   - ページが正しいエンコーディング（UTF-8など）であることを確認

### 一部のテキストが翻訳されない

**症状**：ページの一部が元言語のまま残る

**原因**：
- JavaScriptで動的に読み込まれるコンテンツ
- iframe内のコンテンツ
- 画像内のテキスト

**解決策**：
1. **動的コンテンツの場合**：
   - ページを完全に読み込んでから翻訳を実行
   - スクロールしてすべてのコンテンツを表示

2. **iframe内コンテンツ**：
   - 現在、iframe内のコンテンツは翻訳されません
   - iframeのソースURLを直接開いて翻訳

3. **画像内テキスト**：
   - 画像内のテキストは翻訳できません
   - OCRツールと組み合わせて使用することを検討

## パフォーマンスの問題

### 翻訳が非常に遅い

**症状**：翻訳に予想以上の時間がかかる

**解決策**：
1. **モデルを変更**：
   - より高速なモデルを使用
   - GPT-4 → GPT-3.5
   - Claude Opus → Claude Haiku

2. **チャンクサイズを最適化**：
   - 大きすぎるチャンクは処理が遅い
   - 小さすぎるチャンクはリクエスト数が増える
   - 推奨：2000-5000文字

3. **並列処理を有効化**：
   - 設定で「並列リクエスト数」を増やす（APIレート制限に注意）

4. **キャッシュを活用**：
   - 翻訳キャッシュが有効になっているか確認

### ブラウザが重くなる

**症状**：拡張機能を使用するとブラウザの動作が遅くなる

**解決策**：
1. **メモリ使用量を確認**：
   - タスクマネージャーでメモリ使用量を確認
   - 他の拡張機能を無効化

2. **キャッシュをクリア**：
   - 設定で「キャッシュをクリア」を実行
   - 古いキャッシュデータを削除

3. **バッチサイズを調整**：
   - 設定で一度に処理する要素数を減らす

4. **ブラウザを再起動**：
   - メモリリークの可能性がある場合、ブラウザを再起動

## プロバイダー固有の問題

### OpenAI関連

#### "Insufficient quota" エラー

**症状**：「クォータが不足しています」というエラー

**解決策**：
1. [OpenAI ダッシュボード](https://platform.openai.com/account/usage)で使用量を確認
2. 請求情報を確認し、必要に応じてクレジットを追加
3. 使用制限を確認・調整

#### モデルが見つからない

**症状**：「Model not found」エラー

**解決策**：
1. 設定でモデル名を確認（例：`gpt-4-turbo-preview`）
2. アカウントが該当モデルにアクセスできるか確認
3. 利用可能なモデルに変更

### Claude関連

#### "Overloaded" エラー

**症状**：「システムが過負荷です」というエラー

**解決策**：
1. 数分待ってから再試行
2. ピーク時間帯を避ける
3. 別のプロバイダーを使用

#### レスポンスが途切れる

**症状**：翻訳が途中で終わる

**解決策**：
1. 設定で「最大トークン数」を増やす（例：4096 → 8192）
2. チャンクサイズを小さくする

### Gemini関連

#### "Safety ratings" エラー

**症状**：安全性フィルターによりブロックされる

**解決策**：
1. コンテンツが安全性ガイドラインに準拠しているか確認
2. 別のプロバイダーを使用
3. テキストを修正して再試行

### Ollama関連

#### 接続できない

**症状**：「Ollamaサーバーに接続できません」エラー

**解決策**：
1. **Ollamaサーバーを起動**：
   ```bash
   ollama serve
   ```

2. **エンドポイントを確認**：
   - 設定で `http://localhost:11434` になっているか確認
   - カスタムポートを使用している場合は適切に設定

3. **モデルを確認**：
   ```bash
   # インストール済みモデルを確認
   ollama list

   # モデルがない場合はダウンロード
   ollama pull llama2
   ```

4. **ファイアウォールを確認**：
   - ローカルホストへの接続が許可されているか確認

#### 翻訳が非常に遅い

**症状**：Ollamaでの翻訳が極端に遅い

**原因**：
- CPUで実行している（GPUが未使用）
- モデルが大きすぎる

**解決策**：
1. **GPUを有効化**（NVIDIA GPUがある場合）：
   - CUDA対応版のOllamaをインストール
   - GPUドライバーを最新に更新

2. **より小さなモデルを使用**：
   - `llama2:7b` の代わりに `llama2:3b`
   - `mistral` の代わりに `gemma:2b`

3. **ハードウェアを確認**：
   - 推奨：最低16GB RAM、できればGPU

## ブラウザ互換性の問題

### Chrome固有の問題

#### Service Workerがクラッシュする

**解決策**：
1. `chrome://extensions/` で拡張機能を再読み込み
2. Chromeを最新版に更新
3. Chromeを再起動

### Edge固有の問題

#### 拡張機能が同期されない

**解決策**：
1. Edgeの同期設定を確認
2. アカウントからサインアウト→サインイン
3. 拡張機能を再インストール

## デバッグ方法

### コンソールログを確認

1. **バックグラウンドスクリプト**：
   - `chrome://extensions/` を開く
   - Multi-AI Translatorを見つける
   - 「Service Worker」リンクをクリック
   - DevToolsでログとエラーを確認

2. **コンテンツスクリプト**：
   - 翻訳したいページでF12を押す
   - コンソールタブでエラーを確認

3. **ポップアップ/オプション**：
   - ポップアップまたはオプションページを右クリック
   - 「検証」を選択
   - DevToolsでエラーを確認

### ネットワーク通信を確認

1. DevToolsを開く（F12）
2. 「ネットワーク」タブを選択
3. 翻訳を実行
4. APIリクエストとレスポンスを確認
5. エラーコードと詳細メッセージを確認

### ログを収集

問題を報告する際に役立つ情報：
1. ブラウザのバージョン
2. 拡張機能のバージョン
3. 使用しているプロバイダーとモデル
4. エラーメッセージの全文
5. コンソールログのスクリーンショット
6. 問題が発生するURL（可能であれば）

## サポート

問題が解決しない場合：

1. **FAQを確認**：[FAQ-ja.md](FAQ-ja.md)
2. **GitHub Issuesを検索**：既知の問題か確認
3. **新しいIssueを作成**：
   - [GitHub Issues](https://github.com/yourusername/multi-ai-translator/issues)
   - 上記のログ情報を含める
   - 問題の再現手順を詳しく記載

## ログ収集コマンド

デバッグ情報を収集するための便利なコマンド：

```bash
# Ollamaのバージョン確認
ollama --version

# Ollamaのモデル一覧
ollama list

# Ollamaのログ確認（Linuxの場合）
journalctl -u ollama -f

# ブラウザのバージョン確認（コンソールで実行）
navigator.userAgent
```

## 予防的なヒント

問題を未然に防ぐために：

1. **定期的な更新**：
   - 拡張機能を最新版に保つ
   - ブラウザを最新版に更新

2. **バックアップ**：
   - 重要な設定をメモ
   - APIキーを安全に保管

3. **テスト**：
   - 重要な翻訳の前に小さなテキストでテスト
   - 複数のプロバイダーを設定してバックアップを確保

4. **監視**：
   - API使用量を定期的に確認
   - クォータや制限に注意

これらの解決策で問題が解決しない場合は、お気軽にサポートにお問い合わせください。
